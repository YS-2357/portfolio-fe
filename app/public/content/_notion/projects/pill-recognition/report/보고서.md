# 📘 프로젝트 보고서: 헬스케어 알약 이미지 인식


- 프로젝트명: **알약 탐지 AI 모델 개발**

- 팀명: **알약탐지단**

- 기간: 2025.03.14 ~ 2025.04.01 (2주)

- 작성자: 정영선, 구극모, 김정훈, 임성은, 정재의

- GitHub: [https://github.com/codeit-Al-Project1/pill_detection_ai](https://github.com/codeit-Al-Project1/pill_detection_ai)

## 🧑‍🤝‍🧑 팀 구성 및 역할



---


## 🧾 프로젝트 요약


본 프로젝트는 이미지 인식 기술을 헬스케어 분야에 적용하여, **알약 이미지 속 각 알약의 위치(Bounding Box)와 종류(Class)를 정확히 예측하는 AI 모델을 구축하는 것**을 목표로 합니다.


이를 통해 사용자는 복약 중인 약에 대한 정보를 자동으로 확인하고, 복용 주의 사항 등을 효과적으로 인지할 수 있습니다.


프로젝트 진행 중, **동일한 형태 및 색상의 약이 다수 존재**해 분류 난이도가 높았고, **클래스 불균형으로 인해 일부 클래스에 대한 인식률이 낮은 문제가 발생**했습니다.


이에 대해 **시각적 특징 강조 증강(Augmentation) 기법과 Focal Loss, 손실 가중치 조절**을 적용하여 분류 성능을 보완하였습니다.


모델 학습과정에서 훈련과 검증을 동시에 진행하여, **검증 mAP50가 개선된 경우에만 모델의 가중치를 저장**해 과적합을 막았습니다.


또한, YOLO와 Faster R-CNN 간의 구조적 차이를 경험할 수 있었으며, **모델별로 최적화된 증강 전략과 하이퍼파라미터 조합을 적용**하여 성능을 극대화했습니다.


**팀원 간 역할 분담과 코드 리뷰를 통해 협업 효율성을 높였고, 주요 실험 결과를 반복적으로 검증하면서 신뢰성 있는 결과를 도출**할 수 있었습니다.


## 🧠 문제 정의


본 프로젝트는 **이미지 기반 객체 탐지(Object Detection)** 문제로 정의됩니다.


사용자는 약을 촬영한 이미지를 입력하면, 모델이 해당 이미지 내 **알약의 위치(Bounding Box)**와 **알약 종류(Class)**를 식별하는 것이 목적입니다.


- 한 이미지에 **3~4개의 알약**이 존재하며, 총 **1489개 이미지**가 존재합니다.

- 각 알약은 **총 74개 클래스 중 하나**에 속합니다.

- 모델은 이미지에서 알약을 검출(위치)하고, 분류(종류)를 동시에 수행해야 합니다.

따라서 본 과제는 **멀티클래스 객체 탐지 문제**로 정의되며, 이에 따라 대표적인 두 객체 탐지 프레임워크인 **Faster R-CNN(Two Stage Detector)**과** YOLO(One Stage Detector)**을 중심으로 성능을 비교 실험하였습니다.


## 📏 평가 지표


모델의 성능 평가는 객체 탐지 분야에서 가장 보편적으로 활용되는 **mAP (mean Average Precision)** 지표를 사용합니다.


- 정확한 박스 탐지와 클래스 예측을 동시에 고려하는 평가 방식입니다.

- 본 프로젝트에서는 **mAP@0.5** (IoU ≥ 0.5일 때 AP 계산)를 채택합니다.

- P-R 커브 분석를 분석해 정밀도 / 재현율 trade-off를 확인합니다.

- 평가 방식: 검증 데이터 기준 mAP + Kaggle leaderboard 제출 점수

## 🧪 데이터 탐색 및 전처리


- `train_images`와 `train_annotations` 기반으로 데이터 구성 분석

- JSON 파일 내 각 이미지에 객체 1개만 포함 → **모든 어노테이션을 이미지 단위로 통합**

- 일부 이미지에서 객체 정보 누락 및 어노테이션 불일치 확인

- 총 1489개 파일 중 26개 파일 바운딩 박스 없음 또는 어긋남 → 16개 **직접 수정. 10개 버림.**

- 클래스 불균형 확인 → **이미지 내 소수 클래스 분포를 고려해 Stratified Split 적용
**(단순 클래스 비율이 아닌, **각 이미지가 포함한 전체 오브젝트의 클래스 구성**을 기준으로 분할)

- **동일한 형태·색상의 약이 다수 존재**해 분류 난이도 증가

- 데이터 다운로드~포맷 변경까지 전체 전처리 프로세스 **모듈화 완료**

- 전체 이미지 전처리: 정규화 및 크기 통일 (YOLOv8 default: 640)

---


## ⚙ 전체 파이프라인 구성


데이터 정제 및 병합 → 데이터 전처리 및 포맷 변경 → 데이터 로딩 및 증강 처리
→ 모델 학습 및 성능 평가 → 결과 시각화 및 제출



---


## 📢 모델링 결과 요약


1. ✅ 최종 채택 모델: Faster R-CNN** (Backbone: MobileNet_v3)**

1. ✅ 최종 채택 모델: **YOLOv8-l (large)**

---


## ⚗ 실험 요약 - Faster R-CNN


### 1. 데이터 증강


- Augmentations: RandomResizedCrop(640), HorizontalFlip, VerticalFlip, ColorJitter, Grayscale, Perspective, GaussianBlur

- ~~Rotation~~ → Bounding Box의 변형이 일어나 채택하지 않음

### 2. 실험 결과


- 클래스 분류 손실이 가장 큰 문제로 파악되어, **Focal Loss 적용 및 classifier loss 가중치 조정**

- 모든 backbone에서 classification loss가 가장 느리게 수렴

- mobilenet_v3_large가 가장 mAP 성능이 우수함


### 3. Backbone 별 Metric 비교




![](https://prod-files-secure.s3.us-west-2.amazonaws.com/74816d19-4826-4987-99da-a7850e85f3d3/ffd1ac41-c412-4db2-9219-0f02a13bb33c/output.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466SMCYSGPH%2F20260113%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260113T080706Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEDcaCXVzLXdlc3QtMiJHMEUCIQCz4LUILWJZQ4dN7zvNtj5H3CDuYpF%2F0%2BVsBQwiP8q2AwIgdDKieCI9GlxOy4yZz6hCTM4%2FZ1%2FnPlZqxbpRKrZ3Ey4q%2FwMIABAAGgw2Mzc0MjMxODM4MDUiDEktshjq6mKztvzVBCrcA8k9HylKSyBfohGmzlC0l5BPqwyo2H%2BWHzGv2SHEV3u4%2FLDHGFQFPI4sVl%2Bx4oVK%2B54qjyVHovOrwBz9hFVfW7qZ%2FJrSyzCCo%2BFSNlmAGaE%2BaM%2FQmqBVBOIYaB80b1nnh52JFvYl%2BV%2BGuIowZC774yc24wBqsq9neWzuatpQBVv%2FQ80kG2fHfEtGYJ%2BBf%2BahH4hz1pd2AvkWm7ahEyWLXEXFh4CJJ3pK6Mwx2jJ2j0OvptQlRylF1nxZG3bNqBmIkng%2FX6yD73UEGgjOKlLblLvd%2BC%2Fu7r1R6cCrd1w%2B3B3QQb80jF%2F2Bvc02PX7mTtk%2B0zbtOhE1VaIOoK4QYPdDBwTcA3aNpHxLsbuuNdDnXRRg0frF5ouJpJ212Mpl2WMoPjl5OcHYcRwHM2A9MWbOIuSzksMg1oh0nCgPcZrpqp%2F476FYR3tMNxSJDYpaGxjxKMhKHf4lnho0KdbOIxdDrepb4HKFDELAuzvvD6SvxymWhA5LhrnbUwciAcjfibaN5HaClqQ9r05OY0Kf%2FQEa4VvwK6vgJxOlgcj%2B2fKmoF51zqNB%2F6a8%2BmFneB5LTleML1rBL%2BaMKTI%2BbyNOPFUwGpYW9xIC6sFUnix8gsgsbziA6FCaOcRSDjNUsXwMMTgl8sGOqUBlc%2F3ab461xe5mVzlzt7Zx9egzW0QRziaJMEDAfnsC9%2F60zOb%2FEfzWagmvzrXlCX8IkRQUqC3BTIz17TID2RDk%2B6u00pD841LiWrKKH5xQdBmTFlfjAEvwKPsAt0SElmZUf4NR0iJSBUsvPDE6gqrDOBzFIf0yi8vvJ01DvszHvOfHSv84ere27vYK5XJIL%2BpVWWBusDGeAAyNfIDjnss3aZbMV1X&X-Amz-Signature=884448f8098f1e8911587f7279b7833d6d25250b9b4a4d25577465867137cdb8&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)




### 4. Epoch 진행에 따른 예측 이미지 변화



### 5. 결론


- 본 지표는 Faster R-CNN에 다양한 Backbone을 적용했을 때의 성능 비교 결과이며, **mobilenet_v3_large**를 **Backbone**으로 사용할 경우 **가장 빠른 성능 향상**을 보였음을 나타낸다.

- 각 지표를 통해 확인할 수 있는 바는,** Objectness Loss, Box Loss, RPN Loss**는 학습 초반부터 빠르게 수렴하는 반면, **Classification Loss**는 상대적으로 느리게 수렴하는 경향을 보였다는 점이다.

- 첨부된 이미지는 각각 6, 15, 20번째 에폭 종료 시점에서 **중간 점검용으로 추출한 테스트 이미지에 대한 예측 결과**이다. Confidence Score의 임계값은 기본값인 0.5로 설정했으며, 이미지에 대한 Bounding Box는 적절하게 그려지지만, **분류(classification) 단계에서 오분류가 발생하는 사례**를 확인할 수 있다.
왜 오분류를 하는가?

- 이를 통해 판단할 수 있는 점은, **Faster R-CNN은 객체 탐지와 Bounding Box 추론에 있어 우수한 성능을 보이는 반면**, 모델 구조가 복잡한 만큼 **현재 사용한 데이터셋 규모로는 분류 성능까지 안정적으로 학습하기에는 한계가 있었음**을 시사한다.

---


## ⚗ 실험 요약 - YOLO


### 1. 데이터 증강


- Augmentations: Mosaic / HSV augmentation (h=0.015, s=0.7, v=0.4) / Horizontal Flip (p=0.5) / Translate (0.1) / Scale (0.5)

### 2. Optimizer 성능 비교 요약 (YOLOv8n 기준, Epochs: 1~10)




![](https://prod-files-secure.s3.us-west-2.amazonaws.com/74816d19-4826-4987-99da-a7850e85f3d3/38159a12-9025-4dcd-9918-a2fd1b96ed54/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466SMCYSGPH%2F20260113%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260113T080706Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEDcaCXVzLXdlc3QtMiJHMEUCIQCz4LUILWJZQ4dN7zvNtj5H3CDuYpF%2F0%2BVsBQwiP8q2AwIgdDKieCI9GlxOy4yZz6hCTM4%2FZ1%2FnPlZqxbpRKrZ3Ey4q%2FwMIABAAGgw2Mzc0MjMxODM4MDUiDEktshjq6mKztvzVBCrcA8k9HylKSyBfohGmzlC0l5BPqwyo2H%2BWHzGv2SHEV3u4%2FLDHGFQFPI4sVl%2Bx4oVK%2B54qjyVHovOrwBz9hFVfW7qZ%2FJrSyzCCo%2BFSNlmAGaE%2BaM%2FQmqBVBOIYaB80b1nnh52JFvYl%2BV%2BGuIowZC774yc24wBqsq9neWzuatpQBVv%2FQ80kG2fHfEtGYJ%2BBf%2BahH4hz1pd2AvkWm7ahEyWLXEXFh4CJJ3pK6Mwx2jJ2j0OvptQlRylF1nxZG3bNqBmIkng%2FX6yD73UEGgjOKlLblLvd%2BC%2Fu7r1R6cCrd1w%2B3B3QQb80jF%2F2Bvc02PX7mTtk%2B0zbtOhE1VaIOoK4QYPdDBwTcA3aNpHxLsbuuNdDnXRRg0frF5ouJpJ212Mpl2WMoPjl5OcHYcRwHM2A9MWbOIuSzksMg1oh0nCgPcZrpqp%2F476FYR3tMNxSJDYpaGxjxKMhKHf4lnho0KdbOIxdDrepb4HKFDELAuzvvD6SvxymWhA5LhrnbUwciAcjfibaN5HaClqQ9r05OY0Kf%2FQEa4VvwK6vgJxOlgcj%2B2fKmoF51zqNB%2F6a8%2BmFneB5LTleML1rBL%2BaMKTI%2BbyNOPFUwGpYW9xIC6sFUnix8gsgsbziA6FCaOcRSDjNUsXwMMTgl8sGOqUBlc%2F3ab461xe5mVzlzt7Zx9egzW0QRziaJMEDAfnsC9%2F60zOb%2FEfzWagmvzrXlCX8IkRQUqC3BTIz17TID2RDk%2B6u00pD841LiWrKKH5xQdBmTFlfjAEvwKPsAt0SElmZUf4NR0iJSBUsvPDE6gqrDOBzFIf0yi8vvJ01DvszHvOfHSv84ere27vYK5XJIL%2BpVWWBusDGeAAyNfIDjnss3aZbMV1X&X-Amz-Signature=b8ec342adbfcb7668c384d45ad723ea526a98dded82eaee16c2b35a71e13f7cf&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


---


### 3. YOLOv8 모델 사이즈 비교 (Epochs: 25 기준)




![](https://prod-files-secure.s3.us-west-2.amazonaws.com/74816d19-4826-4987-99da-a7850e85f3d3/be2833f8-f529-4e85-81ea-63bbf88c265f/map.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466SMCYSGPH%2F20260113%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260113T080706Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEDcaCXVzLXdlc3QtMiJHMEUCIQCz4LUILWJZQ4dN7zvNtj5H3CDuYpF%2F0%2BVsBQwiP8q2AwIgdDKieCI9GlxOy4yZz6hCTM4%2FZ1%2FnPlZqxbpRKrZ3Ey4q%2FwMIABAAGgw2Mzc0MjMxODM4MDUiDEktshjq6mKztvzVBCrcA8k9HylKSyBfohGmzlC0l5BPqwyo2H%2BWHzGv2SHEV3u4%2FLDHGFQFPI4sVl%2Bx4oVK%2B54qjyVHovOrwBz9hFVfW7qZ%2FJrSyzCCo%2BFSNlmAGaE%2BaM%2FQmqBVBOIYaB80b1nnh52JFvYl%2BV%2BGuIowZC774yc24wBqsq9neWzuatpQBVv%2FQ80kG2fHfEtGYJ%2BBf%2BahH4hz1pd2AvkWm7ahEyWLXEXFh4CJJ3pK6Mwx2jJ2j0OvptQlRylF1nxZG3bNqBmIkng%2FX6yD73UEGgjOKlLblLvd%2BC%2Fu7r1R6cCrd1w%2B3B3QQb80jF%2F2Bvc02PX7mTtk%2B0zbtOhE1VaIOoK4QYPdDBwTcA3aNpHxLsbuuNdDnXRRg0frF5ouJpJ212Mpl2WMoPjl5OcHYcRwHM2A9MWbOIuSzksMg1oh0nCgPcZrpqp%2F476FYR3tMNxSJDYpaGxjxKMhKHf4lnho0KdbOIxdDrepb4HKFDELAuzvvD6SvxymWhA5LhrnbUwciAcjfibaN5HaClqQ9r05OY0Kf%2FQEa4VvwK6vgJxOlgcj%2B2fKmoF51zqNB%2F6a8%2BmFneB5LTleML1rBL%2BaMKTI%2BbyNOPFUwGpYW9xIC6sFUnix8gsgsbziA6FCaOcRSDjNUsXwMMTgl8sGOqUBlc%2F3ab461xe5mVzlzt7Zx9egzW0QRziaJMEDAfnsC9%2F60zOb%2FEfzWagmvzrXlCX8IkRQUqC3BTIz17TID2RDk%2B6u00pD841LiWrKKH5xQdBmTFlfjAEvwKPsAt0SElmZUf4NR0iJSBUsvPDE6gqrDOBzFIf0yi8vvJ01DvszHvOfHSv84ere27vYK5XJIL%2BpVWWBusDGeAAyNfIDjnss3aZbMV1X&X-Amz-Signature=9699051f30eb56acd8ee03ca3300772bb9513cda9f597973908bff8eb8978ef4&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 4. AdamW를 사용한 YOLOv8n의 검증 이미지 비교(좌: 검증 이미지/ 우: 예측 이미지)



### 5. 결론


- YOLOv8 모델은 Learning rate: 1e-4, Weight decay: 5e-4일 때, Optimizer 선택에 따라 성능 차이가 크게 나타났으며, **AdamW 사용 시 가장 우수한 성능을 기록**함

- 모델 사이즈에 따라 **정확도-연산 효율 간 trade-off가 분명히 존재**하며, 실제 서비스 목적에 맞는 모델 크기 선택이 중요함을 확인함

## 📈 성능 분석 시각화


- YOLO vs FRCNN 성능 로그 비교

- 📂 이미지 ID: 1 - YOLO vs FRCNN 예측 비교

---


## ⚠ 한계점 및 향후 개선 방안


1. 데이터 불균형

1. 시각적 유사성

1. FRCNN의 한계

1. YOLO의 우수함

1. 실험 로깅 및 재현성 부족

1. 클래스 간 유사도 분석 미흡

---


## 💡 인사이트 및 학습


- 정밀한 실험 설계와 체계적인 로그 분석의 중요성을 실감함

- YOLO 계열 모델의 실용적 우수성 재확인

- 팀원 간의 적극적인 아이디어 공유가 실험 방향성 개선으로 이어짐

---


## 📦 기술 스택



---


## 📂 관련 자료


- 🔗 GitHub: [https://github.com/codeit-Al-Project1/pill_detection_ai](https://github.com/codeit-Al-Project1/pill_detection_ai)

- 🔗 Kaggle: [https://www.kaggle.com/competitions/ai01-level1-project/overview](https://www.kaggle.com/competitions/ai01-level1-project/overview)

- 🏆 Kaggle Score: **0.99857 (YOLOv8l)**

- 📊 최종 mAP@0.5: **0.99334 (YOLOv8l)**

---


**이 보고서는 프로젝트 수행 중 작성된 실험 로그, 협업 일지, 팀 노션 기록 등을 바탕으로 구성되었습니다.**


---

