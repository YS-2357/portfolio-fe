---
태그: []
날짜: "2025-12-12"
이름: "25.12.12 (금)"
---

# 25.12.12 (금)


# 📅 날짜: 25.12.12 (금)


## 🧩 주요 업무


- insure-gpt 백엔드·프론트 전반 안정화 작업 수행 및 비용 최적화 반영함.

- 보장분석 자동화 기준 체계를 문서화하고, 표준 입력/판단/출력의 고정축을 확정하는 조사 작업을 병행함.

## 🎯 목표 정리


### 장기 목표


- 보험가입내역서 PDF를 표준 스키마로 정규화하고, 규칙 기반 판단 + 최소한의 LLM 호출로 “설명 가능한 보장분석”을 안정적으로 제공하는 MVP 완성함.

- 페르소나 조합 기반 표준 기준(금액 범위, 우선순위, 구조 비중, 근거)을 자동 생성하여 확장 가능한 기준 데이터셋을 구축함.

### 단기 목표


- 무의미한 입력(PDF 무관/보장 미존재/미가입 항목)에 대해 LLM 호출 없는 고정 응답·명확한 에러 처리로 비용·품질을 동시에 안정화함.

- 경고(warnings) 체계를 API–UI까지 일관되게 노출하고, 만기/갱신·나이 불일치 등 운영상 중요한 리스크를 사용자에게 즉시 전달함.

## ⚙️ 진행 및 이슈


- **불필요한 LLM 호출 방지 및 빈 PDF 처리**

- **유효성 검사 강화 및 경고 체계 도입**

- **만기/갱신 임박 경고 추가**

- **UI 반영**

## 🧠 느낀 점 및 개선


- 인사이트·트러블슈팅·의사결정의 근거는 발생 직후 기록해야 휘발을 줄일 수 있다는 점을 재확인함.

- LLM 호출 최적화는 비용 절감뿐 아니라, “오분류·환각”이 발생할 수 있는 구간을 줄여 전체 안정성을 높이는 접근으로 정리됨.

- 경고 메시지를 API 응답에 포함시키고 UI에 노출하는 방식은, 품질 이슈를 사용자와 공유하며 입력 오류를 줄이는 운영 장치로 기능함.

## 🤝 협업 및 커뮤니케이션


- “PDF만 허용, 페이지 0개/보장 0개면 LLM 미호출” 등 데모/베타 범위 명확화 기준을 정리하여 기획·개발 간 합의 가능한 정책으로 정형화함.

- 표준 기준(필수 담보, 금액 범위, 우선순위, 구조 기준)을 기준 문서로 정리하여 향후 팀 내 판단 기준 충돌을 줄이는 기반을 마련함.

## 📚 참고 및 학습 내용


- Pydantic 유효성 검증(`model_validator`)을 경고 중심으로 활용하는 패턴 정리함.

- 보장금액 상한을 소득 기반으로 확장하되 시장 상한을 반영하는 클램프 구조를 정리함.

- 데모/베타 운영 정책(동의 기반 보관, 캐시, 피드백/사용량 추적, 워크플로우 다이어그램)을 요구사항 단위로 정리함.

## 📈 성과 및 지표


- LLM 호출 억제 지점(빈 PDF, 미가입 보장, 분석 불가 요약)을 명시적으로 추가하여 비용 누수 구간을 제거함.

- 입력 품질 향상을 위한 경고 체계를 API–UI까지 연결하여 사용자 수정 가능성을 확보함.

- 커밋 4건으로 기능 단위 개선을 완료하고, 변경 파일 6개 범위로 영향도를 제한함.

## 🗓️ 내일 계획


- 만기/갱신 임박 판별의 정확도 개선(갱신형 판별 근거 강화, 날짜 포맷 예외 처리 보강) 진행함.

- 경고 메시지의 우선순위·중복 제거·요약 규칙을 추가하여 UI 노이즈를 줄이는 정책 설계함.

- 표준 기준 CSV 자동 생성 파이프라인의 산출물 검증(샘플링 검수, 기준 충돌 탐지) 및 워크플로우 다이어그램 최신화 진행함.

```json
당신은 ‘업무일지와 회고 정리 전문가’다.  
아래 사용자의 입력을 바탕으로 하루치 업무일지를 Markdown 형식으로 작성하라.  
입력이 비어 있으면 디폴트 예시 내용을 넣는다.  
결과는 실제 업무 문서에 기록 가능한 수준의 정확성·간결성을 유지하라.

---

입력 형식:
[업무 내용]
1. 코드 업무
"""
# 2025-12-12 작업 일지

## 프로젝트 개요

**insure-gpt**는 보험 가입 내역서 PDF를 분석하여 고객의 보장 현황을 진단하는 시스템입니다.

- **입력**: 보험 가입 내역서 PDF + 고객 프로필 (나이, 성별, 직업, 소득 등)
- **처리**: PDF 파싱 → 보장명 추출 → 표준 기준과 비교 → LLM 코멘트 생성
- **출력**: 영역별(암, 뇌혈관, 심장 등) 보장 진단 결과 + 종합 의견

---

## 오늘 작업 내용

### 1. 불필요한 LLM 호출 방지 및 빈 PDF 처리 개선

**문제 상황**
- 보험과 무관한 PDF(예: 일반 문서)를 업로드해도 LLM이 호출되어 불필요한 비용 발생
- 미가입 보장에 대해서도 LLM을 호출하여 코멘트 생성

**해결 방법**

#### 1-1. 빈 PDF 업로드 차단 (`backend/app.py`)
```python
# 실손, 정액요약, 정액상세 모두 비어있으면 에러 반환
if not 실손_data and not 정액요약_data and not 정액상세_data:
    raise HTTPException(
        status_code=status.HTTP_400_BAD_REQUEST,
        detail="입력된 PDF에서 보험 보장 정보를 찾을 수 없습니다. 보험 가입 내역서인지 확인해 주세요."
    )
```

#### 1-2. 미가입 보장 고정 문구 반환 (`backend/analyzer/area.py`)
```python
# 미가입이거나 상세내역 없으면 LLM 호출 없이 고정 문구 반환
if match.진단결과 == "미가입" or not match.상세내역:
    if match.판단근거:
        근거 = match.판단근거.rstrip(".")  # 마침표 제거
        조사 = "를" if 근거[-1] in "아야어여오요우유으이" else "을"  # 을/를 구분
        return f"{근거}{조사} 참고하여 가입을 검토해 보세요."
    return "본인의 상황을 고려하여 가입을 검토해 보세요."
```

#### 1-3. 영역별분석 없음 가드 (`backend/analyzer/summary.py`)
```python
if not 영역별분석_list or all(len(a.보장목록) == 0 for a in 영역별분석_list):
    return "분석할 보장 정보가 없습니다. 보험 가입 내역서를 확인해 주세요."
```

**효과**
- 보험 정보 없는 PDF 업로드 시 명확한 에러 메시지 반환
- 미가입 보장 코멘트에 LLM 비용 절감
- Swagger 문서에 "no_coverage" 에러 케이스 추가

---

### 2. 유효성 검사 강화

**문제 상황**
- 비현실적인 프로필 조합 입력 시 검증 없이 처리
- PDF의 보험나이와 입력 나이가 크게 다를 때 경고 없음
- 금액 이상치(음수, 비현실적 고액) 검증 없음

**해결 방법**

#### 2-1. 프로필 조합 검증 (`backend/schemas.py`)
```python
from pydantic import model_validator

class 고객프로필(BaseModel):
    # ... 기존 필드 ...
    warnings: List[str] = Field(default_factory=list, description="프로필 검증 경고 메시지")

    @model_validator(mode='after')
    def validate_profile_combination(self):
        warnings = []
        age_num = int(self.age.replace('s', ''))

        # 10대 이하 + 기혼
        if age_num <= 10 and self.married == 1:
            warnings.append("10대 이하 기혼은 일반적이지 않습니다. 입력을 확인해 주세요.")

        # 10대 이하 + 부양가족 3명 이상
        if age_num <= 10 and self.dependents >= 3:
            warnings.append("10대 이하에 부양가족 3명 이상은 일반적이지 않습니다.")

        # 소득 0 + 부양가족 3명 이상
        if self.income == 0 and self.dependents >= 3:
            warnings.append("소득 0원에 부양가족 3명 이상은 확인이 필요합니다.")

        self.warnings = warnings
        return self
```

#### 2-2. PDF 보험나이 vs 입력 나이 불일치 경고 (`backend/app.py`)
```python
pdf_보험나이 = 고객정보_data.get("보험나이")
if pdf_보험나이:
    입력_나이대 = int(age.replace('s', ''))
    if abs(pdf_보험나이 - 입력_나이대) > 15:
        profile.warnings.append(
            f"PDF 보험나이({pdf_보험나이}세)와 입력 나이대({age})가 다릅니다. 확인해 주세요."
        )
```

#### 2-3. 금액 이상치 검증 (`backend/analyzer/coverage.py`)
```python
# 음수 금액 → 0으로 처리
if 금액 and 금액 < 0:
    logger.warning(f"[이상치] 음수 금액 감지: {원본명} = {금액}만원 → 0으로 처리")
    금액 = 0

# 50억 초과 경고 (로그만)
if 금액 and 금액 > 500000:  # 50억 = 500,000만원
    logger.warning(f"[이상치] 비현실적 금액: {원본명} = {금액:,}만원 (50억 초과)")
```

**효과**
- 비정상적 입력에 대한 사전 경고로 데이터 품질 향상
- 사용자가 실수를 인지하고 수정할 수 있는 기회 제공

---

### 3. 경고 메시지 API 응답 노출 및 만기/갱신 경고 추가

**문제 상황**
- 경고 메시지가 생성되지만 API 응답에 포함되지 않음
- 보장 만기나 갱신 임박 시 사용자에게 알림 없음

**해결 방법**

#### 3-1. API 응답에 warnings 필드 추가 (`backend/app.py`)
```python
class AnalyzeResponse(BaseModel):
    # ... 기존 필드 ...
    warnings: List[str] = Field(
        default_factory=list,
        description="검증 경고 메시지 목록 (프로필 불일치, 만기 임박 등)"
    )
```

#### 3-2. 만기/갱신 임박 경고 생성 (`backend/app.py`)
```python
from datetime import datetime

today = datetime.now()
만기_임박_목록 = []
갱신_임박_목록 = []

for row in 정액상세_data:
    보장명 = row.get("보장명", "") or row.get("담보명", "")
    보험종기 = row.get("보험종기", "")

    if 보험종기 and 보험종기 != "9999-12-31":
        try:
            종기일 = datetime.strptime(보험종기, "%Y-%m-%d")
            남은일수 = (종기일 - today).days

            # 만기 1년 이내
            if 0 < 남은일수 <= 365:
                만기_임박_목록.append(f"{보장명}({남은일수}일)")

            # 갱신형이고 3개월 이내
            if "갱신" in str(row.get("상품명", "")):
                if 0 < 남은일수 <= 90:
                    갱신_임박_목록.append(f"{보장명}({남은일수}일)")
        except:
            pass

# 경고 메시지 추가
if 만기_임박_목록:
    profile.warnings.append(f"만기 임박 보장: {', '.join(만기_임박_목록[:5])}")
if 갱신_임박_목록:
    profile.warnings.append(f"갱신 임박 보장: {', '.join(갱신_임박_목록[:5])}")
```

**효과**
- 만기/갱신 시점을 놓쳐 보장 공백이 생기는 것 방지
- 고객이 미리 준비할 수 있도록 알림

---

### 4. Streamlit UI에 경고 메시지 표시

**문제 상황**
- API에서 경고가 반환되지만 UI에 표시되지 않음

**해결 방법** (`frontend/streamlit_app.py`)
```python
# 결과 탭 상단에 경고 표시
warnings = result.get('warnings', [])
if warnings:
    st.markdown("### ⚠️ 확인이 필요한 사항")
    for warning in warnings:
        st.warning(warning)
    st.markdown("---")
```

**효과**
- 사용자가 경고 메시지를 즉시 확인 가능
- 결과 탭 상단에 배치하여 가시성 확보

---

## 커밋 이력

| 시간 | 커밋 해시 | 메시지 |
|------|----------|--------|
| 17:21 | `051db10` | feat: 불필요한 LLM 호출 방지 및 빈 PDF 처리 개선 |
| 17:57 | `b88892c` | feat: 유효성 검사 강화 |
| 18:10 | `0a7d1a9` | feat: 경고 메시지 API 응답 노출 및 만기/갱신 경고 추가 |
| 18:18 | `8fb19ff` | feat: Streamlit UI에 경고 메시지 표시 기능 추가 |

---

## 수정된 파일 요약

| 파일 | 변경 내용 |
|------|----------|
| `backend/app.py` | 빈 PDF 차단, 나이 불일치 경고, 만기/갱신 경고, warnings 응답 필드 |
| `backend/schemas.py` | 프로필 조합 검증 (model_validator), warnings 필드 |
| `backend/analyzer/area.py` | 미가입 고정 문구 (을/를 구분) |
| `backend/analyzer/summary.py` | 영역별분석 없음 가드 |
| `backend/analyzer/coverage.py` | 금액 이상치 검증 |
| `frontend/streamlit_app.py` | 경고 메시지 UI 표시 |

---

## 향후 개선 사항 (중기)

1. **API Rate Limiting**: 과도한 요청 방지
2. **분석 메트릭 수집**: 응답 시간, 성공률 등 모니터링
3. **캐싱**: 동일 PDF 재분석 시 결과 캐싱

---

## 기술 스택

- **Backend**: FastAPI, Pydantic
- **Frontend**: Streamlit
- **LLM**: Claude API (보장 매핑, 코멘트 생성)
- **PDF 파싱**: 자체 파서
"""
2. 조사 업무
"""
## 1. 보험 보장분석 자동화 기준 체계 정립

### 1-1. 표준 보험가입내역서 구조 정의

- 보험증권(PDF)에서 **공통적으로 추출 가능한 정보**를 표준화
- 고객 개인정보를 다음과 같이 범주형·수치형 변수로 정리
    - 나이대(10세 단위)
    - 성별
    - 직업군(사무직/일반직/현장직)
    - 월소득 구간(100만원 단위)
    - 기혼 여부
    - 부양가족 수
- 목적:
    
    → 보험증권마다 표현은 달라도 **동일한 판단 로직을 적용**할 수 있는 입력값 확보
    

---

## 2. 필수 보장 항목(담보) 체계 확정

### 2-1. 보험 분석에 반드시 포함할 보장명 세트 확정

- 실손 계열
    - 상해입원의료비 / 질병입원의료비
    - 상해통원의료비 / 질병통원의료비
    - 일상생활 배상책임
- 암 관련
    - 일반암 / 고액암 / 유사암 / 특정암 진단
- 뇌·심장 질환
    - 뇌혈관질환 / 뇌출혈 / 뇌경색
    - 허혈성심장질환 / 급성심근경색
- 수술비
    - 질병·상해 수술 / 종수술
    - 암·뇌혈관·심장 수술
- 후유장해·사망
    - 상해·질병 후유장해
    - 질병사망 / 상해사망
- 목적:
    
    → 설계사·보험사·상품이 달라도 **보장 분석의 기준 축을 고정**
    

---

## 3. 보장금액 판단 기준 정량화

### 3-1. “최소–최대” 보장금액 산정 공식 설계

- 각 담보별로 다음 3요소를 정의
    - 최소금액: 정액 기준(현실적인 하한)
    - 최대금액: 연소득 × 비율
    - 시장최대: 실제 보험시장에서 가능한 상한
- 최종 최대값은 다음 구조로 제한
    - `최대 = clamp(연소득 × 비율, 최소, 시장최대)`
- 목적:
    
    → 소득이 높아질수록 **보장금액이 비현실적으로 커지는 문제 방지**
    

---

## 4. 생애주기·가족구조를 반영한 판단 로직 설계

### 4-1. 미혼·부양가족 없는 경우 예외 처리

- 사망보장:
    - 최소 0 허용
    - 최대도 연소득 100% 이내로 제한
- 이유:
    - 사망 시 경제적 책임 대상이 없는 경우 과도한 보장 방지

### 4-2. 기혼·부양가족 존재 시 상향 기준

- 사망·후유장해:
    - 연소득 2~3배까지 허용
- 암·뇌·심장 진단비:
    - 암 대비 뇌·심장 비율 자동 연동
- 목적:
    
    → **“누가 이 사람의 소득에 의존하는가”**를 판단 기준에 반영
    

---

## 5. 보장 중요도(우선순위) 체계 수립

- 모든 담보를 4단계로 분류
    1. 반드시 필요한 핵심 보장
    2. 여유가 생기면 우선 추가할 보장
    3. 선택적으로 고려할 보장
    4. 특별한 경우가 아니면 불필요한 보장
- 활용 목적:
    - 예산 초과 시 **어떤 담보부터 줄이거나 삭제할지 자동 판단**
    - “왜 이 보장은 유지/삭제 대상인지” 설명 가능

---

## 6. 갱신·비갱신 / 종신·정기 구조 기준 정리

### 6-1. 갱신 vs 비갱신

- 암·뇌·심장 진단/수술:
    - 비갱신형 우선
- 상해·일반수술:
    - 갱신/비갱신 혼용 허용
- 실손:
    - 갱신형 필수 인프라로 별도 취급

### 6-2. 종신 vs 정기

- 종신은 **사망 보장에만 제한적으로 사용**
- 나이·가족구조에 따라 종신/정기 비중 자동 조절

---

## 7. 판단근거 자동 생성 로직 구현

- 각 담보마다 다음을 자동 생성
    - 고객 조건 요약(나이대·성별·직업·결혼·소득)
    - 해당 보장의 역할(치료비 / 소득공백 / 생계보장)
    - 왜 이 금액 범위가 권장되는지
    - 어떤 구조(만기·갱신·배당)가 적절한지
- 목적:
    
    → 결과를 단순 수치가 아니라 **“설명 가능한 보장분석”**으로 제공
    

---

## 8. 고객 페르소나 전체 조합 자동 생성

- 나이 × 성별 × 직업 × 소득 × 부양가족 × 혼인 여부
- 모든 조합에 대해:
    - 보장별 최소/최대 금액
    - 우선순위
    - 구조 비중
    - 판단근거
- 결과물:
    - 고객 조건별 **표준 보장 기준 CSV 수천 개 자동 생성**

---

## 9. 데모/베타 서비스 기획 구체화

### 9-1. 서비스 범위 명확화

- 보험증권 **PDF만 허용**
- PDF가 없거나 페이지 0개 → LLM 호출 없이 고정 문구 출력

### 9-2. 사용자 피드백·추적 설계

- 사용 후 간단 피드백(좋아요/싫어요/의견)
- 사용 이력 및 사용량 추적
- 동일 PDF·동일 스키마는 캐시 사용

### 9-3. 개인정보·PDF 보관 정책 정리

- 명시적 동의 시에만 서버 보관
- 서비스 개선 목적에 한정

---

## 10. 전체 사용자 워크플로우 시각화

- 개인정보 동의 → PDF 업로드 → 유효성 검사
- 캐시 여부 판단 → 분석 수행 또는 결과 반환
- 결과 표시 → 피드백 → 사용자 기록
- 해당 흐름을 **머메이드 다이어그램**으로 정리
"""

[느낀 점]
1. 무엇인가를 느꼇던 것이 있는데 기억나지 않는다. 바로 적어야만 하는 것을 깨달았다.

---

출력 양식:

# 📅 날짜: (예: 25.11.11 (화))

## 🧩 주요 업무
- 오늘 수행한 핵심 업무를 구체적으로 요약  
- 기술적 결과, 진행 상황, 산출물 등을 명시  

## 🎯 목표 정리
### 장기 목표
- 프로젝트의 중장기적 방향 또는 최종 지향점  
### 단기 목표
- 오늘 혹은 이번 주 달성 목표  

## ⚙️ 진행 및 이슈
- 진행 단계별 구체적 내용  
- 발생한 문제와 해결 과정  
- 미해결 과제 및 후속 조치  

## 🧠 느낀 점 및 개선
- 사용자 입력 기반으로 정리된 통찰, 개선 아이디어, 학습 내용  

## 🤝 협업 및 커뮤니케이션
- 회의, 보고, 협업 이슈, 의사소통 내용 정리  
- 논의된 결정사항 및 향후 조율 방향  

## 📚 참고 및 학습 내용
- 새로 학습하거나 참고한 기술·논문·문서  
- 업무 개선에 도움이 된 개념 또는 자료  

## 📈 성과 및 지표
- 정량적 성과(예: 정확도, 속도, 효율 등)  
- 수치가 없을 경우 주요 진척도를 서술  

## 🗓️ 내일 계획
- 다음 업무 목표 및 우선순위  
- 예상 리스크 및 대비책  

---

지침:
1. 전체 분량은 500~650단어 이내로 유지한다.  
2. 문장은 명사형·서술형으로 끝내며, 감정적 표현은 제외한다.  
3. 입력이 비어 있으면 아래 기본 내용을 자동으로 채운다.
4. 날짜는 월화수목금의 요일만 사용한다.

---

[기본 디폴트 예시]
- **업무 내용**: LangChain 실습 복습, 문서 분석 코드 개선, 팀 회의 참석  
- **느낀 점**: 구조화된 학습이 업무 이해에 도움됨. 반복 작업 효율 개선 필요.
```

