---
태그: []
날짜: "2025-12-15"
이름: "25.12.15 (월)"
---

# 25.12.15 (월)


# 📅 날짜: 25.12.15 (월)


## 🧩 주요 업무


- **Docker 기반 배포 체계 구축 및 CI/CD 파이프라인 완성** 수행함.

- **테스트 코드 35개 작성 및 CI 안정화** 수행함.

- **Pydantic V2 마이그레이션 및 경고 제거** 수행함.

- **카카오 채널 성장 전략 회의 정리 및 운영 로드맵 수립** 수행함.

## 🎯 목표 정리


### 장기 목표


- insure-gpt의 배포·테스트·운영을 자동화하여 반복 가능한 릴리즈 체계를 확보하고, 장애·회귀를 CI 단계에서 조기 차단하는 품질 게이트 구축함.

- 카카오 채널을 자사 미디어의 핵심 허브로 고정하고, 보험 판단을 중심으로 의료·금융·건강 정보를 결합한 지속 유입 구조 정착함.

### 단기 목표


- CI에서 테스트(35개) 통과 후 GHCR 이미지 배포까지 일관 동작하는 파이프라인을 고정하고, 문서 기반 온보딩 가능 상태 확보함.

- 채널 개설 직후 “시기성 3종 세트(요약–해석–체크리스트)”로 즉시 운영 가능한 최소 실행 계획을 확정함.

## ⚙️ 진행 및 이슈


- **CI/CD 흐름 확정**: main push → pytest → Docker build → ghcr push → 서버 pull & restart(수동) 구조로 정의함.

- **레지스트리 접근 이슈 대비**: private 이미지 접근을 위한 PAT 권한(`read:packages`) 및 `docker login ghcr.io` 절차를 문서화함.

- **테스트 신뢰성 확보**: premium/ratio 계산, 스키마 경고 케이스, 표준 로더, 분석 모킹 플로우까지 범위를 확장하여 회귀 위험을 감소시킴.

- **Pydantic 경고 대응**: CI 로그의 Deprecated 경고를 제거하여 향후 업그레이드 시 노이즈·실패 가능성을 낮춤.

- **미해결 과제**: `backend/pdf/parser.py:110` 고객정보 추출 키워드 확장 항목을 낮은 우선순위로 백로그화함.

## 🧠 느낀 점 및 개선


- 컨디션 저하 시 생산성 변동 폭이 커지는 점을 확인하고, 업무 기록·검증 단위를 더 잘게 쪼개어 “중간 산출물” 중심으로 진행하는 방식 필요함.

- 콘텐츠 운영은 제재 리스크가 주제보다 표현 방식에 좌우된다는 전제를 기준으로, 안전 문구·금지 항목을 템플릿화하는 개선 필요함.

## 🤝 협업 및 커뮤니케이션


- 카카오 채널 목표를 “친구 수(모수) 증가”로 단일화하고, 외부 광고 의존도 축소 및 콘텐츠 기반 자발 유입 전략에 합의함.

- 리드 매그넷을 “보험 + 돈을 아낄 수 있는 정보, 피가입자에게 유리한 판단 기준”으로 확정하고, 시험 정보는 서브 콘텐츠로 분리함.

- 멀티 채널 역할을 카카오(허브)·인스타/유튜브/블로그(유입)로 분리하고, 정체성 문장·소개 톤·제재 안전 문구를 통일하는 원칙을 확정함.

- 상품/회사/혜택/상담 직접 언급 금지, 기준 변화 설명 중심 운영, 핵심 정보·링크의 카카오 집중 원칙을 안전장치로 채택함.

## 📚 참고 및 학습 내용


- GitHub Actions 기반 CI 구성 패턴, GHCR 배포 및 private 패키지 권한 모델 정리함.

- Pydantic V2 설정 방식(`SettingsConfigDict`, `ConfigDict`) 및 스키마 예시 주입 방식(`json_schema_extra`) 적용함.

- 건강한 채널 운영을 위한 “시기성 정보 트리거”와 “요약–해석–체크리스트” 콘텐츠 구조 정리함.

## 📈 성과 및 지표


- CI 테스트 **35개 통과(30.07s)** 결과 확보 및 파이프라인 상태 **Push → Test → Build → GHCR Push** 성공함.

- Docker 기반 로컬 실행 및 헬스체크 응답(`{"status":"ok"}`) 검증 완료함.

- 문서 산출물 2종(기술 가이드/배포 가이드) 작성으로 재현성·온보딩 효율을 확보함.

## 🗓️ 내일 계획


- 서버 측 수동 배포 단계(pull & restart)를 자동화 가능한 범위로 정리하고, 운영 환경 변수·시크릿 관리 절차 점검함.

- `backend/pdf/parser.py` 고객정보 추출 키워드 확장 백로그의 우선순위 재평가 및 최소 개선 범위 정의함.

- 카카오 채널 첫 운영분으로 시기성 콘텐츠 3종 세트 초안 작성 및 채널별 전환 동선(외부→카카오) 문구 템플릿 확정함.

```mermaid
당신은 ‘업무일지와 회고 정리 전문가’다.  
아래 사용자의 입력을 바탕으로 하루치 업무일지를 Markdown 형식으로 작성하라.  
입력이 비어 있으면 디폴트 예시 내용을 넣는다.  
결과는 실제 업무 문서에 기록 가능한 수준의 정확성·간결성을 유지하라.

---

입력 형식:
[업무 내용]
1. 코드업무
"""
# 2025-12-15 작업 일지

## 개요

Docker 기반 CI/CD 파이프라인 구축 및 테스트 코드 작성을 완료했습니다.

---

## 1. Docker & CI/CD 구성 (2h)

### 1.1 생성된 파일

| 파일 | 용도 |
|------|------|
| `Dockerfile` | Python 3.11 기반 FastAPI 백엔드 이미지 |
| `docker-compose.yml` | 컨테이너 구성 (환경변수, 볼륨, 포트) |
| `.dockerignore` | Docker 빌드 제외 파일 |
| `.github/workflows/ci.yml` | GitHub Actions CI/CD 워크플로우 |
| `docs/docker-cicd-guide.md` | Docker/CI-CD 기술 가이드 |
| `docs/deployment-guide.md` | 배포 가이드 (사용자용) |

### 1.2 Dockerfile 구성

```dockerfile
FROM python:3.11-slim
WORKDIR /app

# 시스템 의존성
RUN apt-get update && apt-get install -y build-essential curl

# Python 의존성
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# 소스 코드
COPY backend/ ./backend/
COPY utils/ ./utils/
COPY data/ ./data/

# 환경변수
ENV PYTHONPATH=/app
ENV PYTHONUNBUFFERED=1

# 헬스체크
HEALTHCHECK --interval=30s --timeout=10s --retries=3 \
    CMD curl -f http://localhost:8000/health || exit 1

EXPOSE 8000
CMD ["uvicorn", "backend.app:app", "--host", "0.0.0.0", "--port", "8000"]
```

### 1.3 CI/CD 파이프라인 흐름

```
Push to main
    ↓
GitHub Actions 실행
    ↓
pytest 테스트 실행
    ↓
Docker 이미지 빌드
    ↓
ghcr.io에 푸시
    ↓
서버에서 pull & restart (수동)
```

### 1.4 GitHub Container Registry (ghcr.io)

- **이미지 위치**: `ghcr.io/intalk-dev/insure-gpt:latest`
- **Private 저장소**: Personal Access Token 필요 (`read:packages` 권한)
- **로그인 방법**: `docker login ghcr.io -u USERNAME`

### 1.5 로컬 Docker 테스트 완료

```bash
# 이미지 Pull
docker pull ghcr.io/intalk-dev/insure-gpt:latest

# 컨테이너 실행
docker run -d -p 8000:8000 --env-file .env --name insure-gpt-api ghcr.io/intalk-dev/insure-gpt:latest

# 헬스체크 확인
curl http://localhost:8000/health
# 응답: {"status":"ok"}
```

---

## 2. 테스트 코드 작성 (1h)

### 2.1 테스트 파일 구성

| 파일 | 테스트 수 | 내용 |
|------|----------|------|
| `tests/test_health.py` | 1개 | API 헬스체크 |
| `tests/test_premium.py` | 8개 | 보험료 계산 로직 |
| `tests/test_schema.py` | 12개 | Pydantic 스키마 검증 |
| `tests/test_standard_loader.py` | 7개 | 표준 CSV 로더 |
| `tests/test_analyzer_mock.py` | 7개 | Mock 데이터 분석 흐름 |
| **합계** | **35개** | |

### 2.2 테스트 상세

#### test_premium.py - 보험료 계산 테스트

```python
class TestCalculateMonthly:
    def test_basic_calculation(self):        # 기본 계산
    def test_duplicate_product(self):        # 상품 중복 제거
    def test_exclude_lump_sum(self):         # 일시납 제외
    def test_empty_list(self):               # 빈 리스트

class TestCalculateRatio:
    def test_appropriate_single(self):       # 미혼 적정
    def test_excessive_single(self):         # 미혼 과다
    def test_appropriate_married(self):      # 기혼 적정
    def test_zero_income(self):              # 소득 0원
```

#### test_schema.py - 스키마 검증 테스트

```python
class TestCustomerProfile:
    def test_valid_profile(self):                      # 정상 프로필
    def test_married_profile(self):                    # 기혼 프로필
    def test_single_no_dependents(self):               # 미혼 무부양
    def test_warning_young_married(self):              # 10대 기혼 경고
    def test_warning_zero_income_many_dependents(self): # 소득0+부양가족 경고
    def test_invalid_gender(self):                     # 잘못된 성별
    def test_invalid_job(self):                        # 잘못된 직업
```

#### test_analyzer_mock.py - Mock 데이터 분석 테스트

```python
# Mock 데이터로 PDF 없이 전체 분석 흐름 테스트
MOCK_정액상세 = [
    {"상품명": "삼성생명 암보험", "보험료": "45,000", ...},
    {"상품명": "한화생명 종신보험", "보험료": "80,000", ...},
]

def test_full_analysis_flow(self):
    # 1. 고객정보 생성
    # 2. 프로필 생성
    # 3. 보험료 계산
    # 4. 비율 계산
    # 5. 결과 검증
```

### 2.3 테스트 실행 결과

```
============================= test session starts =============================
collected 35 items

tests/test_analyzer_mock.py ✓✓✓✓✓✓✓
tests/test_health.py ✓
tests/test_premium.py ✓✓✓✓✓✓✓✓
tests/test_schema.py ✓✓✓✓✓✓✓✓✓✓✓✓
tests/test_standard_loader.py ✓✓✓✓✓✓✓

============================= 35 passed in 30.07s =============================
```

---

## 3. Pydantic V2 마이그레이션 (0.5h)

### 3.1 변경 사유

CI 테스트에서 Pydantic 경고 발생:
```
PydanticDeprecatedSince20: Support for class-based `config` is deprecated
PydanticDeprecatedSince20: Using extra keyword arguments on `Field` is deprecated
```

### 3.2 변경 내용

#### utils/config.py

```python
# Before
from pydantic_settings import BaseSettings
class Settings(BaseSettings):
    class Config:
        env_file = ".env"

# After
from pydantic_settings import BaseSettings, SettingsConfigDict
class Settings(BaseSettings):
    model_config = SettingsConfigDict(
        env_file=".env",
        env_file_encoding="utf-8",
        extra="ignore",
    )
```

#### backend/app.py

```python
# Before
from pydantic import BaseModel, Field
class ChatRequest(BaseModel):
    message: str = Field(..., example="실손보험이 뭐야?")
    class Config:
        json_schema_extra = {...}

# After
from pydantic import BaseModel, Field, ConfigDict
class ChatRequest(BaseModel):
    message: str = Field(..., json_schema_extra={"example": "실손보험이 뭐야?"})
    model_config = ConfigDict(json_schema_extra={...})
```

### 3.3 수정된 파일

- `utils/config.py`: `class Config` → `model_config = SettingsConfigDict()`
- `backend/app.py`: 3개의 `class Config` → `model_config = ConfigDict()`
- `backend/app.py`: 10개의 `Field(example=...)` → `Field(json_schema_extra={"example": ...})`

---

## 4. 기타 변경 사항

### 4.1 헬스체크 응답 표준화

```python
# Before
return {"status": "healthy"}

# After (일반적인 관례에 맞춤)
return {"status": "ok"}
```

### 4.2 .env.example 업데이트

다중 LLM API 키 지원 추가:
- XAI_API_KEY (Grok)
- GEMINI_API_KEY
- ANTHROPIC_API_KEY
- OPENAI_API_KEY
- DEEPSEEK_API_KEY
- LANGCHAIN 설정

### 4.3 부양가족 범위 확장

`scripts/generate_standard_csv.py`:
```python
# Before
DEPENDENTS_OPTIONS = [0, 1, 2, 3, 4, 5]  # 6개

# After
DEPENDENTS_OPTIONS = [0, 1, 2, 3, ..., 20]  # 21개
```

### 4.4 불필요한 문서 삭제

- `docs/refactoring-plan.md` 삭제 (리팩토링 완료로 더 이상 불필요)

---

## 5. Git 커밋 내역

| 커밋 | 내용 |
|------|------|
| `ci: Docker 및 GitHub Actions CI/CD 구성 추가` | Docker, CI/CD 파일 생성 |
| `test: 테스트 폴더 초기화` | tests/__init__.py |
| `test: 헬스체크 테스트 추가 및 CI 설정 수정` | test_health.py, httpx 추가 |
| `fix: 헬스체크 테스트 응답값 수정` | healthy → ok |
| `refactor: 헬스체크 응답값을 "ok"로 통일` | backend/app.py 수정 |
| `docs: Docker 배포 가이드 문서 추가` | deployment-guide.md |
| `refactor: Pydantic V2 문법 업데이트 및 기타 수정` | Pydantic 경고 해결 |
| `test: 유닛 테스트 추가 (35개)` | 4개 테스트 파일 추가 |

---

## 6. 현재 프로젝트 상태

### 6.1 완료된 항목

- [x] Docker 컨테이너화
- [x] GitHub Actions CI/CD
- [x] ghcr.io 이미지 배포
- [x] 유닛 테스트 35개
- [x] Pydantic V2 경고 해결
- [x] 배포 가이드 문서화

### 6.2 CI/CD 파이프라인 상태

```
Push → Test (35개) → Build → ghcr.io Push ✅
```

### 6.3 남은 TODO

- `backend/pdf/parser.py:110`: 고객정보 추출 키워드 확장 (낮은 우선순위)

---

## 7. 참고: Docker 명령어

```bash
# 이미지 Pull
docker pull ghcr.io/intalk-dev/insure-gpt:latest

# 컨테이너 실행
docker run -d -p 8000:8000 --env-file .env --name insure-gpt-api ghcr.io/intalk-dev/insure-gpt:latest

# 로그 확인
docker logs -f insure-gpt-api

# 컨테이너 중지/삭제
docker rm -f insure-gpt-api

# 이미지 삭제
docker rmi ghcr.io/intalk-dev/insure-gpt:latest
```

---

## 8. 참고: 테스트 실행 명령어

```bash
# 전체 테스트
pytest tests/ -v

# 특정 파일
pytest tests/test_premium.py -v

# 특정 테스트
pytest tests/test_schema.py::TestCustomerProfile::test_valid_profile -v
```
"""
2. 회의 업무
"""
1. 카카오 채널 성장 목표 및 성공지표 재정의

카카오 채널 확장의 핵심 목표를 친구 수(모수) 증가로 명확화

현재 친구 수(1,191명)를 기준으로 한 채널 성장 관점 정립

외부 광고 의존도를 낮추고 콘텐츠 기반 자발적 유입 전략 채택

2. 리드 매그넷(채널 추가 이유) 전략 정리

고객이 ‘귀찮음’을 감수하고 채널을 추가할 핵심 이유 정의

보험설계사 시험 정보는 서브 콘텐츠로 분리

메인 방향을

보험 + 돈을 아낄 수 있는 정보

피가입자에게 유리한 판단 기준 제공
로 확정

3. 시기성 정보 중심 콘텐츠 전략 수립

“내일 / 내달 / 내년부터 바뀌는 것”을 핵심 트리거로 설정

시기성 정보의 강점:

놓치면 되돌릴 수 없는 손해

행동을 즉시 유도

시기성 정보는 자사 미디어에서만 풀고, 외부 채널은 최소 정보만 노출하는 구조로 설계

4. 보험 단일 주제에서 의료·금융·건강으로 확장하는 원칙 정립

보험을 **메인 축(Decision Hub)**으로 유지

의료·금융·건강은 보험 판단에 영향을 주는 입력 변수로 정의

단순 정보 나열이 아니라
→ “이 변화가 보험에서 어떤 의미를 가지는가”로 항상 회수하는 구조 확립

5. 정보전달 vs 광고·금융유도 제재 기준 정리

제재 여부는 주제 자체가 아니라 표현 방식에 의해 결정된다는 점 정리

안전 영역:

제도·기준·조건 변화 설명

판단 기준 제공

위험 영역:

금전적 이익 보장

상담·혜택·행동 직접 유도

현재 설계한 구조는 정보 해석 채널로서 제재 리스크가 낮다는 결론 도출

6. 계정 개설 직후 즉시 운영 가능한 실행 로드맵 수립

계정 개설 다음 날 바로 운영 가능하도록 초기 가동 전략 정리

첫 콘텐츠는 완성도보다 작동 여부에 집중

시기성 콘텐츠 3종 세트(요약–해석–체크리스트) 구조 확정

7. 멀티 채널 계정 세팅 가이드 정리

카카오 채널을 메인 자사 미디어로 확정

인스타·유튜브·인블로그를 유입·인지용 보조 채널로 역할 분리

모든 채널에 공통 적용할:

정체성 문장

소개 문구 톤

제재 안전 문구
를 통일

8. 채널 운영 원칙 및 안전장치 확립

상품·회사·혜택·상담 언급 금지

“혜택 제공”이 아닌 “기준 변화 설명” 중심 운영

링크와 핵심 정보는 카카오 채널로만 집중
"""

[느낀 점]
1. 오늘은 컨디션이 안좋아서 힘들었다. 컨디션 조절을 잘 해야겠다.

---

출력 양식:

# 📅 날짜: (예: 25.11.11 (화))

## 🧩 주요 업무
- 오늘 수행한 핵심 업무를 구체적으로 요약  
- 기술적 결과, 진행 상황, 산출물 등을 명시  

## 🎯 목표 정리
### 장기 목표
- 프로젝트의 중장기적 방향 또는 최종 지향점  
### 단기 목표
- 오늘 혹은 이번 주 달성 목표  

## ⚙️ 진행 및 이슈
- 진행 단계별 구체적 내용  
- 발생한 문제와 해결 과정  
- 미해결 과제 및 후속 조치  

## 🧠 느낀 점 및 개선
- 사용자 입력 기반으로 정리된 통찰, 개선 아이디어, 학습 내용  

## 🤝 협업 및 커뮤니케이션
- 회의, 보고, 협업 이슈, 의사소통 내용 정리  
- 논의된 결정사항 및 향후 조율 방향  

## 📚 참고 및 학습 내용
- 새로 학습하거나 참고한 기술·논문·문서  
- 업무 개선에 도움이 된 개념 또는 자료  

## 📈 성과 및 지표
- 정량적 성과(예: 정확도, 속도, 효율 등)  
- 수치가 없을 경우 주요 진척도를 서술  

## 🗓️ 내일 계획
- 다음 업무 목표 및 우선순위  
- 예상 리스크 및 대비책  

---

지침:
1. 전체 분량은 500~650단어 이내로 유지한다.  
2. 문장은 명사형·서술형으로 끝내며, 감정적 표현은 제외한다.  
3. 입력이 비어 있으면 아래 기본 내용을 자동으로 채운다.
4. 날짜는 월화수목금의 요일만 사용한다.

---

[기본 디폴트 예시]
- **업무 내용**: LangChain 실습 복습, 문서 분석 코드 개선, 팀 회의 참석  
- **느낀 점**: 구조화된 학습이 업무 이해에 도움됨. 반복 작업 효율 개선 필요.
```

