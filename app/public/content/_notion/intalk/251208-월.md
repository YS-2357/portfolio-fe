---
태그: []
날짜: "2025-12-08"
이름: "25.12.08 (월)"
---

# 25.12.08 (월)


# 📅 날짜: 25.12.08 (월)


## 🧩 주요 업무


- PDF 파싱·분석 파이프라인에 LLM 기반 Fallback 기능 도입하여 인식 실패율을 낮추고 처리 안정성을 향상

- 실손 세대 판별 기능을 비동기 방식으로 전환하고 LLM 보조 판단을 추가하여 정확도 개선

- 보장명 매핑 오류 사례를 정리하고 COVERAGE_ALIAS 확장으로 도메인 오분류 문제 해소

- 챗봇 스키마(의도, 검증 점수, reject 노드 구조 등)를 실제 반환값과 일치하도록 정비

- 로깅 구조 통일 및 OpenAPI 문서 확장으로 API 유지보수성 향상

- README 전면 개편하여 분석·fallback 구조를 문서화

- 전체 분석 속도를 비동기화·병렬화로 최적화하여 기존 3분 → 약 40초 수준으로 단축

## 🎯 목표 정리


### 장기 목표


- 보험 PDF를 안정적으로 구조화하고, LLM 기반 보정(fallback)까지 포함한 견고한 보장분석 엔진 구축

- 인톡파트너스 2.0의 핵심 기능(보장분석 + 챗봇)의 기술적 기반 확보 및 표준화된 API 제공

### 단기 목표


- 테이블 분류 및 실손 세대 판별 기능의 정확도 향상

- 챗봇 의도·경로 체계 정리 및 OpenAPI 문서화 완성

- 크레딧 기반 분석 기능 및 로그인 연동 설계 구체화

## ⚙️ 진행 및 이슈


- **PDF 테이블 분류 개선**

- **실손 세대 판별 강화**

- **보장명 매핑 오류 수정**

- **챗봇 스키마 조정**

- **API 및 문서 정리**

## 🧠 느낀 점 및 개선


- LLM Fallback 도입 전후의 안정성 차이가 명확하여, 규칙 기반 파싱과 LLM의 결합이 보험 도메인 PDF 분석에 특히 적합함을 확인

- 스키마·엔드포인트 문서화는 개발 후반보다 초기에 정비할수록 전체 팀 커뮤니케이션 비용이 감소함

- 분석 속도 개선이 사용자 경험에 미치는 영향이 크므로, 병렬화·비동기화는 지속적으로 보강할 필요 있음

## 🤝 협업 및 커뮤니케이션


- 인톡파트너스 2.0 기획과 연계해 보장분석 기능과 챗봇 기능의 역할을 구분하고, 로그인 기반 접근·크레딧 제한 등 운영 정책을 공유

- 챗봇은 단순 QnA가 아닌 화면 기반 내비게이터 역할을 수행하도록 방향성 논의 완료

- 개발과 기획 간 기능명·스키마 용어를 일치시키는 작업 필요성 확인

## 📚 참고 및 학습 내용


- LangChain structured output 활용 사례

- PDF 테이블 구조 재구성 전략 및 멀티헤더 파싱 패턴

- 보험 실손 세대별 제도 변경 연표와 자기부담률 기준

## 📈 성과 및 지표


- 분석 속도: **180초 → 약 40초(78% 단축)**

- 챗봇 의도·경로 평가 기준 최신화 후 정확도 **90% 이상 유지**

- 테이블 분류 실패율 감소(L angChain fallback 적용 후 테스트 기준 오분류 거의 없음)

## 🗓️ 내일 계획


- 테이블 분류 및 실손 세대 판단의 LLM 프롬프트 세분화

- 크레딧 기반 보장분석 호출 구조 설계 초안 작성

- 사용자 로그인 연계 시나리오 및 챗봇 권한 제어 설계

- PDF 분석 결과의 UI 표시 구조 점검 및 통합 테스트 진행

```json
당신은 ‘업무일지와 회고 정리 전문가’다.  
아래 사용자의 입력을 바탕으로 하루치 업무일지를 Markdown 형식으로 작성하라.  
입력이 비어 있으면 디폴트 예시 내용을 넣는다.  
결과는 실제 업무 문서에 기록 가능한 수준의 정확성·간결성을 유지하라.

---

입력 형식:
[업무 내용]
1. 코드작업
"""
# 2025-12-08 작업 일지

## 1. PDF 테이블 분류 LLM Fallback 추가

### 파일: `backend/pdf_parser.py`

**변경 내용:**
- `_classify_table_with_llm()` 함수 추가
- LangChain `with_structured_output()` 사용
- `TableType` Enum 및 `TableClassificationResult` Pydantic 모델 추가

**동작 흐름:**
1. 키워드 매칭으로 테이블 유형 분류 (실손/정액요약/정액상세)
2. 매칭 실패 시 → LLM fallback (최대 5행 샘플 분석)

**코드 예시:**
```python
class TableType(str, Enum):
    silson = "실손"
    summary = "정액요약"
    detail = "정액상세"
    other = "기타"

class TableClassificationResult(BaseModel):
    table_type: TableType
    reason: str
```

**주의:** 한글 클래스명 사용 시 OpenAI API 오류 발생 → 영어 클래스명 사용

---

## 2. 실손 세대 판별 LLM Fallback 추가

### 파일: `backend/analyzer.py`

**변경 내용:**
- `analyze_indemnity()` → `analyze_indemnity_async()` 비동기로 변경
- `_classify_indemnity_generation_with_llm()` 함수 추가

**판별 기준:**
| 세대 | 가입 시기 | 자기부담금 |
|------|----------|----------|
| 1세대 | ~2009.09.30 | 0~5% |
| 2세대 | 2009.10.01~2017.03.31 | 10% |
| 3세대 | 2017.04.01~2021.06.30 | 20% |
| 4세대 | 2021.07.01~ | 30% |

**동작 흐름:**
1. 보험시기로 세대 판별
2. 없으면 → 자기부담비율로 판별
3. 둘 다 없으면 → LLM fallback

---

## 3. 보장명 매핑 개선

### 파일: `backend/mappings.py`

**추가된 매핑:**
```python
COVERAGE_ALIAS = {
    "암진단": "일반암진단",      # 특정암진단 아님
    "암진단비": "일반암진단",
    "소액암진단": "유사암진단",
    ...
}
```

**문제 해결:**
- 기존: "암진단"이 LLM에 의해 "특정암진단"으로 잘못 매핑됨
- 해결: COVERAGE_ALIAS에 명시적 매핑 추가

---

## 4. 챗봇 스키마 수정

### 파일: `backend/app.py`, `backend/chatbot.py`

**수정 내용:**

1. **validation_score 범위 수정**
   - 기존: `ge=0, le=10` (0-10)
   - 수정: `ge=0, le=100` (0-100)
   - 원인: 챗봇이 실제로 0-100 범위의 점수를 반환

2. **ChatIntent Enum 정리**
   - 기존: `coverage_inquiry, product_comparison, claim_procedure, general_question, greeting, other`
   - 수정: `coverage_inquiry, general_question, pdf_analysis, unknown`
   - 이유: chatbot.py에서 실제 반환하는 의도와 일치

3. **reject_node 필드 명시화**
   ```python
   return {
       "messages": [("assistant", reject_message)],
       "intent": "unknown",
       "validation_score": 0,
       "final_answer": reject_message,
   }
   ```

---

## 5. 로거 통일

### 파일: `backend/pdf_parser.py`

**변경 내용:**
- `from utils.config import debug_log` → `from utils.logger import get_logger`
- `debug_log()` → `logger.debug()`

---

## 6. FastAPI OpenAPI 문서 개선

### 파일: `backend/app.py`

**추가된 문서화:**
- `tags_metadata`: 엔드포인트 카테고리 (헬스체크, 챗봇, 분석)
- 상세한 `Field()` 설명 및 예시
- 에러 응답 스키마 (`ErrorResponse`)
- 엔드포인트별 상세 docstring

---

## 7. README 업데이트

### 파일: `README.md`, `backend/README.md`

**추가된 내용:**
- LLM Fallback 지원 테이블
- 분석 단계별 fallback 설명
- chatbot 의도 유형 설명
- pdf_parser LLM fallback 설명

---

## 수정된 파일 목록

| 파일 | 변경 내용 |
|------|----------|
| `backend/pdf_parser.py` | LLM 테이블 분류, 로거 통일 |
| `backend/analyzer.py` | 실손 세대 LLM fallback |
| `backend/mappings.py` | 암진단 매핑 추가 |
| `backend/chatbot.py` | reject_node 필드 명시화 |
| `backend/app.py` | validation_score, ChatIntent 수정, OpenAPI 개선 |
| `README.md` | LLM fallback 설명 추가 |
| `backend/README.md` | 함수 설명 업데이트 |

---

## 커밋 이력

```
c8fa2d2 feat: LLM fallback 전면 적용 및 챗봇 스키마 수정
```
"""
- 비동기/병렬 적용으로 3분에서 40초로 분석시간 감소
- 판단기준 피드백을 적용해 최신화된 기준 적용
- 정확도 90% 이상
2. 인톡파트너스 2.0 기획
인톡파트너스 2.0은 보장분석 기능과 챗봇 기능을 추가
챗봇은 네비게이터 및 qna 헬퍼, 로그인한 사용자만 사용 가능
보장분석은 크레딧 방식 횟수제한

[느낀 점]
1. (업무 중 느낀 점, 개선점, 배운 점 등)

---

출력 양식:

# 📅 날짜: (예: 25.11.11 (화))

## 🧩 주요 업무
- 오늘 수행한 핵심 업무를 구체적으로 요약  
- 기술적 결과, 진행 상황, 산출물 등을 명시  

## 🎯 목표 정리
### 장기 목표
- 프로젝트의 중장기적 방향 또는 최종 지향점  
### 단기 목표
- 오늘 혹은 이번 주 달성 목표  

## ⚙️ 진행 및 이슈
- 진행 단계별 구체적 내용  
- 발생한 문제와 해결 과정  
- 미해결 과제 및 후속 조치  

## 🧠 느낀 점 및 개선
- 사용자 입력 기반으로 정리된 통찰, 개선 아이디어, 학습 내용  

## 🤝 협업 및 커뮤니케이션
- 회의, 보고, 협업 이슈, 의사소통 내용 정리  
- 논의된 결정사항 및 향후 조율 방향  

## 📚 참고 및 학습 내용
- 새로 학습하거나 참고한 기술·논문·문서  
- 업무 개선에 도움이 된 개념 또는 자료  

## 📈 성과 및 지표
- 정량적 성과(예: 정확도, 속도, 효율 등)  
- 수치가 없을 경우 주요 진척도를 서술  

## 🗓️ 내일 계획
- 다음 업무 목표 및 우선순위  
- 예상 리스크 및 대비책  

---

지침:
1. 전체 분량은 500~650단어 이내로 유지한다.  
2. 문장은 명사형·서술형으로 끝내며, 감정적 표현은 제외한다.  
3. 입력이 비어 있으면 아래 기본 내용을 자동으로 채운다.
4. 날짜는 월화수목금의 요일만 사용한다.

---

[기본 디폴트 예시]
- **업무 내용**: LangChain 실습 복습, 문서 분석 코드 개선, 팀 회의 참석  
- **느낀 점**: 구조화된 학습이 업무 이해에 도움됨. 반복 작업 효율 개선 필요.
```

