---
태그: []
날짜: "2025-12-02"
이름: "25.12.02 (화)"
---

# 25.12.02 (화)


# 📅 날짜: 25.12.02 (화)


## 🧩 주요 업무


- `data/standard/내 기준.md`의 오타·번호 체계를 정리하고, 보험료 비율 기준 등 핵심 원칙을 코드 상수·검증 로직에 반영하여 백엔드 전반의 기준 일관성을 확보함

- `generate_standard_csv.py`, `pdf_parser.py`, `standard_loader.py`, `main.py`, `config.py` 등을 리팩토링하여 표준 CSV 생성·로딩·분석 파이프라인을 “내 기준” 문서와 동기화함

- LangChain + LangGraph 기반의 보험 전문 챗봇 v2(분류 노드 + 라우팅 + 캐싱)를 `notebooks/chatbot.ipynb`에서 설계하고, 그래프 상태/노드/조건부 엣지 구조를 정의함

- 보험 도메인 강의 전체를 설계 기준·리스크 프레임·생애주기별 원칙으로 재정리하고, 이를 바탕으로 표준 보험가입내역서 기준 문서와 설계용 기준 파일의 구조를 고도화함

- 주요 LLM(Upstage, Gemini, Anthropic, Perplexity, OpenAI)의 보험 도메인 적합성을 비교하고, 보장분석 GPT의 금액 산정식·페르소나 기반 추천 로직 개선 방향을 검토함

## 🎯 목표 정리


### 장기 목표


- “내 기준” 문서를 단일 진실 소스로 두고, 표준 CSV·분석 엔진·LangGraph 챗봇·보장분석 GPT 전체에서 동일한 보험 설계 기준(보험료 비율, 우선순위, 금액 배수, 구조 원칙 등)을 일관되게 적용하는 시스템 구축

- 보험 도메인 강의·실무 규칙·시장 관행을 구조화하여, 미숙련 설계사도 보장분석 GPT와 챗봇을 통해 실무 수준에 근접한 설계·설명을 수행할 수 있는 기반 마련

### 단기 목표


- Jupyter 커널 문제를 해결하여 LangGraph 챗봇 v2를 실제로 실행·검증하고, 향후 RAG·도구 노드(보험료 계산, PDF 분석 등)와 연동 가능한 최소 동작 버전을 확보

- 표준 기준 파일을 설계사 친화적인 포맷(예시 중심, Notion 호환, 코드블럭 구조)으로 재정비하고, 표준 보험가입내역서·보장 기준표와의 연결 구조를 명확히 문서화

## ⚙️ 진행 및 이슈


- **문서 및 기준 정리**

- **백엔드 리팩토링**

- **LangGraph 챗봇 설계**

- **도메인 학습 및 기준 파일 재작성**

- **모델 비교 및 GPT 개선 논의**

## 🧠 느낀 점 및 개선


- 기준 문서와 코드 사이의 불일치를 줄이기 위해 “내 기준 → 상수/함수 → CSV → 분석/챗봇”의 흐름을 의식적으로 맞추는 작업이 유효하다는 점을 확인함

- LangGraph 기반 구조를 간단한 분기부터 도입함으로써, 이후 RAG·도구 노드·메모리 확장을 단계적으로 적용하기에 적합한 기반을 마련한 것으로 판단됨

## 🤝 협업 및 커뮤니케이션


- 설계사용 기준 파일 포맷, 보장 금액 배수 범위, 보험료 비율 기준 등은 향후 팀 내 논의와 피드백이 필요한 항목으로 구분하여 정리함

- 여러 모델의 도메인 적합성에 대한 비교 결과는 향후 서비스용 기본 모델 선정 및 멀티 LLM 전략 수립 시 참고 자료로 활용 가능함

## 📚 참고 및 학습 내용


- 보험 강의 내용을 위험률·손실 규모 매트릭스, 필수 보장군, 정기/종신·갱신/비갱신 구조, 생애주기별 설계 전략 등으로 재정리함

- LangGraph의 상태기반 워크플로우 구성, 조건부 엣지, 캐싱 적용 패턴을 챗봇 설계에 적용함

## 📈 성과 및 지표


- `내 기준.md`와 주요 백엔드 모듈 간의 기준 일관성을 확보하여, 기준 변경 시 코드 반영 경로가 명확해짐

- LangGraph 기반 챗봇 v2의 구조 설계와 노드 정의를 완료해, 커널 이슈 해결 후 즉시 실행·검증 가능한 수준으로 정리함

## 🗓️ 내일 계획


- VSCode에서 Jupyter 커널 인식 문제를 해결하고, LangGraph 챗봇 플로우에 대한 단위·통합 테스트 진행

- 표준 기준 파일을 설계사 관점 문서와 모델 입력용 구조(코드블럭/JSON 템플릿)로 이원화하여 정리

- 암 진단비(일반암·고액암·유사암·특정암) 등 핵심 보장군에 대해 연령·가족력·부양가족·생활습관을 반영한 세분화 구간 초안을 구체화하고, 정량 기준 범위를 재점검

```json
당신은 ‘업무일지와 회고 정리 전문가’다.  
아래 사용자의 입력을 바탕으로 하루치 업무일지를 Markdown 형식으로 작성하라.  
입력이 비어 있으면 디폴트 예시 내용을 넣는다.  
결과는 실제 업무 문서에 기록 가능한 수준의 정확성·간결성을 유지하라.

---

입력 형식:
[업무 내용]
1. 코드 작업
"""
# 2025-12-02 작업 요약

## 개요

`내 기준.md` 문서 정리, 백엔드 코드 리팩토링, LangGraph 기반 챗봇 구현 및 프로젝트 정리 작업을 수행했습니다.

---

## 주요 작업 내용

### 1. `내 기준.md` 문서 수정

`data/standard/내 기준.md` 파일의 오타 및 번호 체계를 수정했습니다.

#### 수정 내용
- **오타 수정**: "상해입원통원비" → "상해통원의료비", "질병입원통원비" → "질병통원의료비"
- **번호 체계 수정**: 중복된 "1." 번호들을 순차적인 번호(1~7)로 변경, 하위 항목은 (가), (나), (다) 형식으로 구분
- **188행 별표 오타 수정**: `*기존 계약의 유지·조정` → `**기존 계약의 유지·조정**`

---

### 2. 백엔드 코드 리팩토링 (`내 기준.md` 기반)

`내 기준.md`와 현재 코드를 비교 분석하고, 일관성을 맞추기 위해 백엔드 파일들을 수정했습니다.

#### 2.1 `generate_standard_csv.py` (표준 CSV 생성 스크립트)
- `내 기준.md`의 정량 기준에 맞게 계산 로직 업데이트
- 결혼여부/부양가족에 따른 차등 적용 강화

#### 2.2 `pdf_parser.py` (PDF 파싱 엔진)
- 보험료 비율 판정 기준을 `내 기준.md`와 일치시키기
- 미혼: 5% 이내 권장, 6% 초과 시 과다
- 기혼: 10% 이내 권장, 11% 초과 시 과다

#### 2.3 `schemas.py` (Pydantic 데이터 모델)
- 프로필 체계 확장 검토 (연령대, 소득 구간 등)

#### 2.4 `analyzer.py` (LangGraph 워크플로우)
- `validate_grounding_node`에서 `ChatOpenAI` 직접 생성 대신 `get_llm()` 싱글톤 사용으로 변경

#### 2.5 `standard_loader.py` (표준 CSV 로더)
- 문서 주석에 `내 기준.md` 기반 설명 추가
- `REQUIRED_COLUMNS` 상수 추가 (필수 컬럼 목록)
- `_validate_csv_columns()` 함수 추가 (CSV 컬럼 검증)
- `load_standard_csv()` 함수에 에러 처리 강화

#### 2.6 `main.py` (CLI 진입점)
- 문서 주석에 `내 기준.md` 기반 설명 추가
- 헬퍼 함수 추가 (`_print_separator()`, `_get_status_icon()`, `_get_premium_status_icon()`)
- argparse 개선 (epilog 예시 추가)
- 에러 처리 강화 및 출력 형식 개선

#### 2.7 `config.py` (환경 설정)
- `내 기준.md` 기반 상수 추가:
  - `PREMIUM_RATIO_SINGLE` (5.0%)
  - `PREMIUM_RATIO_SINGLE_MAX` (6.0%)
  - `PREMIUM_RATIO_MARRIED` (10.0%)
  - `PREMIUM_RATIO_MARRIED_MAX` (11.0%)
- `LLM_MODEL`, `LLM_TEMPERATURE`를 환경변수로 설정 가능하도록 변경

---

### 3. Jupyter 커널 설정

`notebooks/chatbot.ipynb`에서 `.venv` 가상환경을 사용하도록 커널을 등록했습니다.

```bash
# 커널 등록 명령어
python -m ipykernel install --user --name=insure-gpt --display-name="insure-gpt (.venv)"
```

등록된 커널 경로: `C:\Users\user\AppData\Roaming\jupyter\kernels\insure-gpt`

---

### 4. LangGraph 기반 챗봇 구현 (v2 - 판단 노드 + 캐싱)

`notebooks/chatbot.ipynb`에 LangChain + LangGraph를 활용한 보험 전문 챗봇을 구현했습니다.

#### 4.1 구조

```
START → classifier → (보험 관련: chatbot → END)
                   → (비보험: reject → END)
```

조건부 분기를 통해 보험 관련 질문만 처리하는 구조입니다.

#### 4.2 GraphState 정의

```python
from typing import Annotated, TypedDict, Literal
from langgraph.graph.message import add_messages

class GraphState(TypedDict):
    messages: Annotated[list, add_messages]  # 메시지(누적되는 list)
    is_insurance_related: bool  # 보험 관련 여부 (True/False)
```

#### 4.3 노드 구성

| 노드 | 역할 |
|------|------|
| `classifier` | 보험 관련 여부 판단 (1: 보험, 0: 비보험) |
| `chatbot` | 보험 상담사 시스템 프롬프트 적용, 응답 생성 |
| `reject` | 비보험 질문에 대한 거절 메시지 반환 |

```python
# 분류 노드
def classifier(state: GraphState) -> GraphState:
    """사용자 메시지가 보험 관련인지 판단"""
    # LLM으로 보험 관련 여부 판단 (1 또는 0)
    ...
    return {"is_insurance_related": is_related}

# 라우팅 함수
def route_by_topic(state: GraphState) -> Literal["chatbot", "reject"]:
    if state["is_insurance_related"]:
        return "chatbot"
    return "reject"
```

#### 4.4 캐싱 기능

```python
from langchain_community.cache import InMemoryCache
from langchain.globals import set_llm_cache

# 동일 질문에 대한 LLM 응답 캐싱
set_llm_cache(InMemoryCache())
```

#### 4.5 그래프 구성

```python
graph_builder = StateGraph(GraphState)

# 노드 추가
graph_builder.add_node("classifier", classifier)
graph_builder.add_node("chatbot", chatbot)
graph_builder.add_node("reject", reject)

# 엣지 연결
graph_builder.add_edge(START, "classifier")
graph_builder.add_conditional_edges(
    "classifier",
    route_by_topic,
    {"chatbot": "chatbot", "reject": "reject"}
)
graph_builder.add_edge("chatbot", END)
graph_builder.add_edge("reject", END)

graph = graph_builder.compile()
```

#### 4.6 테스트 케이스

- 보험 관련 질문 테스트 (chatbot 노드로 라우팅)
- 비보험 질문 테스트 (reject 노드로 라우팅)
- 멀티턴 대화 테스트
- 캐싱 성능 테스트

**참고**: 현재 Jupyter 커널 문제로 실행 테스트는 보류 중

---

### 5. 프로젝트 정리

- `docs/` 폴더 제거
- 작업 기록을 루트 폴더에 날짜별 마크다운 파일로 관리 (`25-12-02.md`)

---

## 파일 변경 목록

### 수정된 파일

1. **data/standard/내 기준.md** - 오타 및 번호 체계 수정
2. **scripts/generate_standard_csv.py** - 계산 로직 업데이트
3. **backend/pdf_parser.py** - 보험료 비율 판정 기준 수정
4. **backend/schemas.py** - 프로필 체계 검토
5. **backend/analyzer.py** - `get_llm()` 싱글톤 사용
6. **backend/standard_loader.py** - CSV 컬럼 검증 추가
7. **backend/main.py** - 출력 형식 개선 및 에러 처리
8. **backend/config.py** - 보험료 비율 상수 추가
9. **notebooks/chatbot.ipynb** - LangGraph 챗봇 구현

### 삭제된 파일

10. **docs/** 폴더 전체 삭제

### 생성된 파일

11. **25-12-02.md** - 오늘 작업 기록

---

## 다음 작업 예정

1. Jupyter 커널 문제 해결 후 챗봇 테스트
2. RAG 연동 (보험 문서 검색 기반 응답)
3. 도구(Tool) 노드 추가 (보험료 계산, PDF 분석 등)
4. 메모리/체크포인트 기능 검토 (세션 간 대화 지속성 필요 시)

---

## 기술 스택

- **LangChain**: LLM 추상화 및 체인 구성
- **LangGraph**: 상태 기반 그래프 워크플로우 (조건부 엣지)
- **OpenAI GPT-4o-mini**: LLM 모델
- **LangSmith**: 트레이싱 및 모니터링 (LANGCHAIN_TRACING_V2)
- **InMemoryCache**: LLM 응답 캐싱

---

## 이슈

- **Jupyter 커널 문제**: VSCode에서 `insure-gpt (.venv)` 커널이 표시되지 않거나 선택 불가. 커널은 등록되어 있음 (`C:\Users\user\AppData\Roaming\jupyter\kernels\insure-gpt`)
"""
2. 업무 내용
"""
2025-12-02(화) 업무일지 요약
1. 보험 도메인 학습 및 정리 작업

강의 전체 내용을 구조화하여 보험 설계 기준·리스크 프레임·보장 우선순위·생애주기별 설계 기준으로 재정리.

이를 기반으로 표준 보험가입내역서 기준 문서를 강화된 형태로 개선.

사망·암·2대질환·후유장해·실손·수술비 등 핵심 보장군별 정량 기준(연소득 배수·비율·우선순위) 추가 정리.

정기/종신, 갱신/비갱신, 납입/보장기간 등 구조적 원칙을 보장분석 GPT에 적용하기 쉬운 형태로 정제.

2. 표준 기준 파일(설계사용) 재작성

설계사가 처음 봐도 이해 가능한 포맷으로 변환 요청.

개인정보 수치화 부분을 제외하고 예시 중심 설명 문서 포맷 생성 요청.

전체 기준을 Notion 호환 포맷 + 코드블럭 형식으로 요약 구조화 추진.

3. 암 진단비 기준 세분화

기존 “총합 기준”을 넘어,
일반암·고액암·유사암·특정암으로 구분한 설계 기준 요청.

20대/30~40대/가족력·생활습관·부양가족 유무 등 케이스별 구간화 검토.

4. 모델별 보험 도메인 적합성 비교

Gemini / Upstage / Perplexity / Anthropic / OpenAI 응답 비교 테스트 수행.

보험 도메인 적합성 평가 기준으로 정확도·실무성·한국 규제 반영·구조 이해도 분석.

Upstage가 가장 보험 실무에 가깝고, 그 다음 Gemini·Anthropic 순으로 판단.

5. 보장분석 GPT 개선 방향 논의

정액담보, 진단비, 수술비 등 금액 산정식의 현실성과 시장 표준 반영 방식 검토.

사망보장·암·2대질환 등 연소득 기반 배수 방식에 대한 대안 및 조정 필요성 논의.

페르소나 기반 보장 추천 시 과도한 보장금액 증가 방지 방식 고려.
"""

[느낀 점]
1. (업무 중 느낀 점, 개선점, 배운 점 등)

---

출력 양식:

# 📅 날짜: (예: 25.11.11 (화))

## 🧩 주요 업무
- 오늘 수행한 핵심 업무를 구체적으로 요약  
- 기술적 결과, 진행 상황, 산출물 등을 명시  

## 🎯 목표 정리
### 장기 목표
- 프로젝트의 중장기적 방향 또는 최종 지향점  
### 단기 목표
- 오늘 혹은 이번 주 달성 목표  

## ⚙️ 진행 및 이슈
- 진행 단계별 구체적 내용  
- 발생한 문제와 해결 과정  
- 미해결 과제 및 후속 조치  

## 🧠 느낀 점 및 개선
- 사용자 입력 기반으로 정리된 통찰, 개선 아이디어, 학습 내용  

## 🤝 협업 및 커뮤니케이션
- 회의, 보고, 협업 이슈, 의사소통 내용 정리  
- 논의된 결정사항 및 향후 조율 방향  

## 📚 참고 및 학습 내용
- 새로 학습하거나 참고한 기술·논문·문서  
- 업무 개선에 도움이 된 개념 또는 자료  

## 📈 성과 및 지표
- 정량적 성과(예: 정확도, 속도, 효율 등)  
- 수치가 없을 경우 주요 진척도를 서술  

## 🗓️ 내일 계획
- 다음 업무 목표 및 우선순위  
- 예상 리스크 및 대비책  

---

지침:
1. 전체 분량은 500~650단어 이내로 유지한다.  
2. 문장은 명사형·서술형으로 끝내며, 감정적 표현은 제외한다.  
3. 입력이 비어 있으면 아래 기본 내용을 자동으로 채운다.
4. 날짜는 월화수목금의 요일만 사용한다.

---

[기본 디폴트 예시]
- **업무 내용**: LangChain 실습 복습, 문서 분석 코드 개선, 팀 회의 참석  
- **느낀 점**: 구조화된 학습이 업무 이해에 도움됨. 반복 작업 효율 개선 필요.
```

